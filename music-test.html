<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Music Player Test - MADE INFINITE</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 50px auto;
            padding: 20px;
            background: #f0f0f0;
        }
        .test-container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
        .test-file {
            background: #f8f8f8;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            border: 1px solid #ddd;
        }
        .play-btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        .play-btn:hover {
            background: #0056b3;
        }
        .status {
            margin: 20px 0;
            padding: 10px;
            border-radius: 5px;
            font-weight: bold;
        }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>üéµ Music Player Test</h1>
        <div id="status" class="status info">Loading music files...</div>
        
        <h3>Available Music Files:</h3>
        <div id="musicList">Loading...</div>
        
        <h3>Test Instructions:</h3>
        <ul>
            <li>Click any Play button to test the music player</li>
            <li>Use keyboard shortcuts when player is open:
                <ul>
                    <li><strong>Space:</strong> Play/Pause</li>
                    <li><strong>‚Üê ‚Üí:</strong> Previous/Next track</li>
                    <li><strong>‚Üë ‚Üì:</strong> Volume up/down</li>
                    <li><strong>M:</strong> Mute/Unmute</li>
                    <li><strong>Escape:</strong> Close player</li>
                </ul>
            </li>
        </ul>
        
        <h3>Console Output:</h3>
        <div id="console" style="background: #000; color: #0f0; padding: 10px; font-family: monospace; height: 200px; overflow-y: auto;"></div>
    </div>

    <script>
        // Simple console logging
        const consoleDiv = document.getElementById('console');
        const originalLog = console.log;
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            consoleDiv.innerHTML += args.join(' ') + '<br>';
            consoleDiv.scrollTop = consoleDiv.scrollHeight;
        };
        
        console.log('üéµ Music Player Test Starting...');
        
        // Test the API
        async function testMusicPlayer() {
            try {
                const response = await fetch('/api/files');
                const data = await response.json();
                
                if (response.ok && data.files) {
                    document.getElementById('status').innerHTML = `‚úÖ Found ${data.files.length} music files`;
                    document.getElementById('status').className = 'status success';
                    
                    let html = '';
                    data.files.forEach((file, index) => {
                        html += `
                            <div class="test-file">
                                <strong>üéµ ${file.name}</strong><br>
                                <small>Size: ${formatFileSize(file.size)} | Uploaded: ${new Date(file.createdTime).toLocaleString()}</small><br>
                                <button class="play-btn" onclick="testPlay(${index}, '${file.streamUrl}', '${file.name}')">‚ñ∂Ô∏è Test Play</button>
                                <button class="play-btn" onclick="window.open('${file.streamUrl}', '_blank')">üîó Open URL</button>
                            </div>
                        `;
                    });
                    
                    document.getElementById('musicList').innerHTML = html;
                    window.musicFiles = data.files;
                    console.log(`‚úÖ Loaded ${data.files.length} music files successfully`);
                } else {
                    throw new Error('No files found');
                }
            } catch (error) {
                console.log('‚ùå Error loading music files:', error);
                document.getElementById('status').innerHTML = '‚ùå Error loading music files: ' + error.message;
                document.getElementById('status').className = 'status error';
            }
        }
        
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }
        
        function testPlay(index, url, name) {
            console.log(`üéµ Testing playback: ${name}`);
            console.log(`üîó Stream URL: ${url}`);
            
            // Create a simple audio player
            const audio = new Audio(url);
            audio.controls = true;
            audio.volume = 0.5;
            
            // Create a popup player
            const popup = window.open('', 'MusicPlayer', 'width=400,height=300');
            popup.document.write(`
                <html>
                    <head><title>üéµ ${name}</title></head>
                    <body style="font-family: Arial; padding: 20px; text-align: center;">
                        <h3>üéµ Now Playing</h3>
                        <p><strong>${name}</strong></p>
                        <audio controls autoplay style="width: 100%; margin: 20px 0;">
                            <source src="${url}" type="audio/mpeg">
                            Your browser does not support audio playback.
                        </audio>
                        <br><br>
                        <button onclick="window.close()">Close Player</button>
                    </body>
                </html>
            `);
            
            console.log(`‚úÖ Opened popup player for: ${name}`);
        }
        
        // Start the test
        testMusicPlayer();
        
        console.log('üéµ Music Player Test Ready!');
    </script>
</body>
</html> 